#!/usr/bin/env ruby

require "smart_machine"

command = ARGV.shift

machine = SmartMachine::Machine.new

case command
when "--version"
	puts "SmartMachine #{SmartMachine.version}"
	return
when "new"
	raise "Can't create a machine inside a machine. Please come out of the machine directory to create another machine." if machine.in_machine_dir?

	name = ARGV.shift
	machine.create(name)
	return
end

if machine.in_machine_dir?
	case command
	when "credentials:edit"
		credentials = SmartMachine::Credentials.new
		credentials.edit
	when "ssh"
    ssh = SmartMachine::SSH.new
    ssh.login
	when "install"
		machine.install package_name: ARGV[0]
	when "uninstall"
		machine.uninstall package_name: ARGV[0]
	when "docker"
    docker = SmartMachine::Docker.new
    docker.run ARGV
	when "grids"
		machine.grids ARGV
	when "apps"
		machine.apps ARGV
	when "sync"
		sync = SmartMachine::Sync.new
		sync.run
	else
		puts "Help: Specify a valid smartmachine command to execute inside the machine directory."
	end
else
	puts "Help: Specify a valid smartmachine command to execute. Are you in the correct directory to run this command?"
end
